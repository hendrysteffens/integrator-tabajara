/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package integrator.generator

import integrator.generator.generator.generateDto
import integrator.generator.generator.generateWorkflow
import integrator.generator.sdl.ExtractSdlData
import integrator.generator.tbs.TbsDataExtractor
import integrator.generator.template.DtoTemplate
import integrator.generator.template.WorkflowTemplate
import integrator.generator.util.*
import java.io.File
import java.io.FileInputStream
import java.nio.file.Paths
import java.util.*

class App {
    val props = Properties()

    val entity: String
        get() {
            return ExtractSdlData(props).getSdlEntityText();
        }

    fun getResouce() :String{
        return this.javaClass.classLoader.getResource("generator.properties").file;
    }

    init {
        props.load(FileInputStream(this.getResouce()))
    }
}

fun main(args: Array<String>) {

    val app = App()

    if (args.isNotEmpty()) {
        app.props.setProperty("integrator.entity", args[0])
    }

    if (File("main.sdl").exists()) {
        app.props.setProperty("integrator.backend.location", Paths.get("").toAbsolutePath().toString())
    }

    ExtractSdlData(app.props).extractData(app.entity).second.forEach {
        fields -> println(fields)
    }
    println(generateDto(ExtractSdlData(app.props).extractData(app.entity), DtoTemplate().templateString));

    var G5Table = "R034CON";
    TbsDataExtractor(app.props).extractTbsData(G5Table)?.let{
        generateWorkflow(it, ExtractSdlData(app.props).extractData(app.entity).first.toString(), G5Table, WorkflowTemplate().templateString, ExtractSdlData(app.props).extractData(app.entity).second)
    };

    FileGenerator().createFileByNameAndText(ExtractSdlData(app.props).extractData(app.entity).first+"Dto.java", generateDto(ExtractSdlData(app.props).extractData(App().entity), DtoTemplate().templateString))

}

