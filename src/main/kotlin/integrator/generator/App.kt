/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package integrator.generator

import integrator.generator.generator.generateDto
import integrator.generator.generator.generateWorkflow
import integrator.generator.sdl.ExtractSdlData
import integrator.generator.tbs.TbsDataExtractor
import integrator.generator.template.DtoTemplate
import integrator.generator.template.WorkflowTemplate
import integrator.generator.util.*
import java.io.File
import java.io.FileInputStream
import java.nio.file.Paths
import java.util.*

class App {
    val entity: String
        get() {
            return ExtractSdlData.getSdlEntityText();
        }

    fun getResouce() :String{
        return this.javaClass.classLoader.getResource("generator.properties").file;
    }
}

fun main(args: Array<String>) {

    val props = Properties()
    props.load(FileInputStream(App().getResouce()))

    if (args.isNotEmpty()) {
        props.setProperty("integrator.entity", args[0])
    }

    if (File("main.sdl").exists()) {
        props.setProperty("integrator.backend.location", Paths.get("").toAbsolutePath().toString())
    }

    ExtractSdlData.extractData(App().entity).second.forEach {
        fields -> println(fields)
    }
    println(generateDto(ExtractSdlData.extractData(App().entity), DtoTemplate().templateString));

    var G5Table = "R034CON";
    TbsDataExtractor(props).extractTbsData(G5Table)?.let{
        generateWorkflow(it, ExtractSdlData.extractData(App().entity).first.toString(), G5Table, WorkflowTemplate().templateString, ExtractSdlData.extractData(App().entity).second)
    };

    FileGenerator().createFileByNameAndText(ExtractSdlData.extractData(App().entity).first+"Dto.java", generateDto(ExtractSdlData.extractData(App().entity), DtoTemplate().templateString))

}

